"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[879],{5879:function(e,s,t){t.d(s,{t:function(){return m}});var l=t(3827),a=t(2235),r=t(94),n=t(8670),o=t(8994),i=t(4090),d=t(1657),c=t(9807),u=t(6288),x=t(7852);function m(e){let{isOpen:s,onClose:t,initialData:m,onSave:b}=e,[h,p]=(0,i.useState)(""),[f,g]=(0,i.useState)([]),[j,v]=(0,i.useState)((null==m?void 0:m.customer)||null),[N,y]=(0,i.useState)(!1),[w,S]=(0,i.useState)(!1),[k,C]=(0,i.useState)(!1),[_,T]=(0,i.useState)(""),[z,O]=(0,i.useState)([]),[E,L]=(0,i.useState)((null==m?void 0:m.staffIds)||[]),[P,D]=(0,i.useState)((null==m?void 0:m.date)||new Date().toISOString().split("T")[0]),[Z,I]=(0,i.useState)((null==m?void 0:m.staffCount)||1),[M,A]=(0,i.useState)((null==m?void 0:m.description)||""),[G,B]=(0,i.useState)((null==m?void 0:m.address)||""),[H,q]=(0,i.useState)((null==m?void 0:m.amount)||""),[K,Y]=(0,i.useState)(!1),[F,Q]=(0,i.useState)("once_week"),[R,J]=(0,i.useState)([]),[U,V]=(0,i.useState)(()=>{let e=new Date;return e.setMonth(e.getMonth()+3),e.toISOString().split("T")[0]}),W=(0,i.useRef)(null);(0,i.useEffect)(()=>{s&&(0,c.sE)(1,50).then(e=>{e.data&&O(e.data)})},[s]),(0,i.useEffect)(()=>{if(s){if(m){let e=m.customerObj||m.customer||null;v(e),p((null==e?void 0:e.name)||("string"==typeof m.customer?m.customer:"")||""),D(m.date?new Date(m.date).toISOString().split("T")[0]:new Date().toISOString().split("T")[0]),A(m.description||""),B(m.address||""),q(void 0!==m.amount&&null!==m.amount?String(m.amount):""),I(m.personnel_count||1),L(m.assigned_staff||[]),Y(m.is_recurring||!1),Q(m.frequency||"once_week")}else v(null),p(""),D(new Date().toISOString().split("T")[0]),A(""),B(""),q(""),I(1),L([]),Y(!1),Q("once_week");g([]),S(!1)}},[s,m]),(0,i.useEffect)(()=>{if(W.current&&clearTimeout(W.current),!h.trim()){g([]),S(!1);return}if(!j||h!==j.name)return W.current=setTimeout(async()=>{y(!0);try{let{data:e}=await (0,c.OL)(1,10,h);g(e||[]),S(!0)}catch(e){console.error(e)}finally{y(!1)}},300),()=>{W.current&&clearTimeout(W.current)}},[h,j]);let X=e=>{v(e),p(e.name),B(e.address||""),S(!1)},$=e=>{L(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])},ee=(e,s)=>{J(t=>t.includes(e)?t.filter(s=>s!==e):t.length>=s?t:[...t,e])},es=async()=>{if(!j){u.toast.error("L\xfctfen bir m\xfcşteri se\xe7in.");return}if(!P){u.toast.error("L\xfctfen tarih se\xe7in.");return}let e={customer_id:j.id,date:P,description:M,address:G,price:parseFloat(H||"0"),personnel_count:Z,is_recurring:K,frequency:K?F:null,recurring_days:K?R:[],recurring_end_date:K?U:null,assigned_staff:E};try{console.log("Saving payload:",e),b?await b(e):u.toast.success("Kayıt işlemi (Demo): Başarılı"),t()}catch(e){console.error("Save error:",e),u.toast.error("Hata oluştu: "+(e.message||e.toString()))}};return s?(0,l.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-slate-900/50 backdrop-blur-sm p-4",children:(0,l.jsxs)("div",{className:"w-full max-w-3xl rounded-xl bg-white shadow-2xl animate-in fade-in zoom-in duration-200 flex flex-col max-h-[90vh]",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between border-b border-slate-100 p-6 shrink-0",children:[(0,l.jsx)("h2",{className:"text-xl font-bold text-slate-900",children:m?"İş Emri D\xfczenle":"Yeni İş Emri Oluştur"}),(0,l.jsx)("button",{onClick:t,className:"rounded-lg p-2 text-slate-400 hover:bg-slate-50 hover:text-slate-600 transition-colors",children:(0,l.jsx)(a.Z,{className:"h-5 w-5"})})]}),(0,l.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[(0,l.jsxs)("div",{className:"space-y-2 relative",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("label",{className:"text-sm font-bold text-slate-900",children:["M\xfcşteri ",(0,l.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,l.jsxs)("button",{onClick:()=>C(!0),className:"flex items-center gap-1 rounded border border-slate-200 px-2 py-1 text-xs font-medium text-slate-600 hover:bg-slate-50",children:[(0,l.jsx)(r.Z,{className:"h-3 w-3"}),"Yeni M\xfcşteri Oluştur"]})]}),(0,l.jsx)(x.Q,{isOpen:k,onClose:()=>C(!1),onSuccess:e=>{X(e)}}),(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)(n.Z,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-slate-400"}),(0,l.jsx)("input",{type:"text",value:h,onChange:e=>{p(e.target.value),j&&e.target.value!==j.name&&v(null)},placeholder:"M\xfcşteri ara (isim veya telefon)...",className:"w-full rounded-lg border border-slate-200 py-2.5 pl-10 pr-4 text-sm outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/10"}),N&&(0,l.jsx)("div",{className:"absolute right-3 top-1/2 -translate-y-1/2",children:(0,l.jsx)(o.Z,{className:"h-4 w-4 animate-spin text-slate-400"})})]}),w&&f.length>0&&(0,l.jsx)("div",{className:"absolute z-10 w-full mt-1 bg-white border border-slate-200 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:f.map(e=>(0,l.jsxs)("button",{onClick:()=>X(e),className:"w-full text-left px-4 py-3 hover:bg-slate-50 border-b border-slate-50 last:border-0",children:[(0,l.jsx)("div",{className:"font-bold text-slate-900 text-sm",children:e.name}),(0,l.jsxs)("div",{className:"text-xs text-slate-500",children:[e.phone," - ",e.address]})]},e.id))}),w&&0===f.length&&h.length>2&&!N&&(0,l.jsx)("div",{className:"absolute z-10 w-full mt-1 bg-white p-4 text-sm text-slate-500 text-center border border-slate-200 rounded-lg shadow-lg",children:"Sonu\xe7 bulunamadı."})]}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("label",{className:"text-sm font-bold text-slate-900",children:["İş Tarihi ",(0,l.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,l.jsx)("input",{type:"date",value:P,onChange:e=>D(e.target.value),className:"w-full rounded-lg border border-slate-200 px-4 py-2.5 text-sm outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/10"})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("label",{className:"text-sm font-bold text-slate-900",children:["Personel Sayısı ",(0,l.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,l.jsx)("input",{type:"number",value:Z,onChange:e=>I(Number(e.target.value)),min:1,className:"w-full rounded-lg border border-slate-200 px-4 py-2.5 text-sm outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/10"})]})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("label",{className:"text-sm font-bold text-slate-900",children:["Personel Se\xe7imi ",(0,l.jsx)("span",{className:"text-xs font-normal text-slate-500",children:"(Opsiyonel - sonra d\xfczenleme ile atanabilir)"})]}),(0,l.jsxs)("div",{className:"rounded-lg border border-slate-200 p-4 space-y-3",children:[(0,l.jsxs)("div",{className:"relative mb-3",children:[(0,l.jsx)(n.Z,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-slate-400"}),(0,l.jsx)("input",{type:"text",value:_,onChange:e=>T(e.target.value),placeholder:"Listede ara...",className:"w-full rounded-lg border border-slate-200 py-2 pl-10 pr-4 text-sm outline-none focus:border-blue-500"})]}),(0,l.jsxs)("div",{className:"space-y-2 max-h-40 overflow-y-auto pr-2",children:[z.filter(e=>{var s,t;return(null===(s=e.full_name)||void 0===s?void 0:s.toLowerCase().includes(_.toLowerCase()))||(null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes(_.toLowerCase()))}).map(e=>(0,l.jsxs)("label",{className:"flex items-center gap-3 p-2 rounded hover:bg-slate-50 cursor-pointer",children:[(0,l.jsx)("input",{type:"checkbox",checked:E.includes(e.id),onChange:()=>$(e.id),className:"h-4 w-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500"}),(0,l.jsx)("span",{className:"text-sm font-medium text-slate-700",children:e.full_name||e.name})]},e.id)),0===z.length&&(0,l.jsx)("div",{className:"text-xs text-slate-400 text-center py-2",children:"Personel bulunamadı"})]})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"text-sm font-bold text-slate-900",children:"A\xe7ıklama"}),(0,l.jsx)("input",{type:"text",value:M,onChange:e=>A(e.target.value),placeholder:"İş a\xe7ıklaması...",className:"w-full rounded-lg border border-slate-200 px-4 py-2.5 text-sm outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/10"})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"text-sm font-bold text-slate-900",children:"Adres"}),(0,l.jsx)("input",{type:"text",value:G,onChange:e=>B(e.target.value),placeholder:"İş adresi...",className:"w-full rounded-lg border border-slate-200 px-4 py-2.5 text-sm outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/10"})]})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("label",{className:"text-sm font-bold text-slate-900",children:["Tutar (₺) ",(0,l.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,l.jsx)("input",{type:"number",value:H,onChange:e=>q(e.target.value),placeholder:"0.00",className:"w-full rounded-lg border border-slate-200 px-4 py-2.5 text-sm outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/10"})]}),(0,l.jsxs)("div",{className:"space-y-4 pt-2 border-t border-slate-100",children:[(0,l.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,l.jsx)("input",{type:"checkbox",checked:K,onChange:e=>Y(e.target.checked),className:"h-4 w-4 rounded border-slate-300 text-blue-600 focus:ring-blue-500"}),(0,l.jsx)("span",{className:"text-sm font-bold text-slate-900",children:"Tekrarlayan İş Emri"})]}),K&&(0,l.jsxs)("div",{className:"space-y-4 pl-6 animate-in slide-in-from-top-2 duration-200",children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"text-sm font-bold text-slate-900",children:"Sıklık"}),(0,l.jsxs)("select",{value:F,onChange:e=>Q(e.target.value),className:"w-full appearance-none rounded-lg border border-slate-200 bg-slate-800 text-white px-4 py-2.5 text-sm outline-none focus:border-blue-500",children:[(0,l.jsx)("option",{value:"once_week",children:"Haftada 1"}),(0,l.jsx)("option",{value:"twice_week",children:"Haftada 2"}),(0,l.jsx)("option",{value:"once_month",children:"Ayda 1"})]})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"text-sm font-bold text-slate-900",children:"Bitiş Tarihi"}),(0,l.jsx)("input",{type:"date",value:U,onChange:e=>V(e.target.value),className:"w-full rounded-lg border border-slate-200 px-4 py-2.5 text-sm outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/10"})]}),"once_week"===F&&(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"text-sm font-bold text-slate-900",children:"G\xfcn Se\xe7imi"}),(0,l.jsx)("div",{className:"flex flex-wrap gap-2",children:["Pzt","Sal","\xc7ar","Per","Cum","Cmt","Paz"].map(e=>(0,l.jsx)("button",{onClick:()=>ee(e,1),className:(0,d.cn)("px-3 py-1.5 rounded text-sm font-medium border transition-colors",R.includes(e)?"bg-blue-600 text-white border-blue-600":"bg-white text-slate-600 border-slate-200 hover:bg-slate-50"),children:e},e))})]}),"twice_week"===F&&(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"text-sm font-bold text-slate-900",children:"G\xfcn Se\xe7imi (En fazla 2)"}),(0,l.jsx)("div",{className:"flex flex-wrap gap-2",children:["Pzt","Sal","\xc7ar","Per","Cum","Cmt","Paz"].map(e=>(0,l.jsx)("button",{onClick:()=>ee(e,2),className:(0,d.cn)("px-3 py-1.5 rounded text-sm font-medium border transition-colors",R.includes(e)?"bg-blue-600 text-white border-blue-600":"bg-white text-slate-600 border-slate-200 hover:bg-slate-50"),children:e},e))})]}),"once_month"===F&&(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"text-sm font-bold text-slate-900",children:"G\xfcn Se\xe7imi"}),(0,l.jsx)("select",{className:"w-full appearance-none rounded-lg border border-slate-200 bg-white px-4 py-2.5 text-sm outline-none focus:border-blue-500",children:Array.from({length:31},(e,s)=>s+1).map(e=>(0,l.jsxs)("option",{value:e,children:[e,". G\xfcn"]},e))})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("label",{className:"text-sm font-bold text-slate-900",children:["Bitiş Tarihi ",(0,l.jsx)("span",{className:"text-xs font-normal text-slate-500",children:"(Opsiyonel)"})]}),(0,l.jsx)("input",{type:"date",className:"w-full rounded-lg border border-slate-200 px-4 py-2.5 text-sm outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500/10"})]})]})]})]}),(0,l.jsxs)("div",{className:"flex justify-end gap-3 border-t border-slate-100 p-6 bg-slate-50 shrink-0 rounded-b-xl",children:[(0,l.jsx)("button",{onClick:t,className:"rounded-lg border border-slate-200 bg-white px-4 py-2 text-sm font-medium text-slate-600 hover:bg-slate-50",children:"İptal"}),(0,l.jsx)("button",{onClick:es,className:"rounded-lg bg-blue-600 px-6 py-2 text-sm font-medium text-white hover:bg-blue-700 shadow-md shadow-blue-200",children:"Kaydet"})]})]})}):null}},8994:function(e,s,t){t.d(s,{Z:function(){return l}});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,t(7461).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])}}]);