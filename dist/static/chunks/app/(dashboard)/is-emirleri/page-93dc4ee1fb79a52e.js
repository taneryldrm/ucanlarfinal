(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[784],{7747:function(e,t,s){Promise.resolve().then(s.bind(s,3728))},3728:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return f}});var a=s(3827),l=s(1232),n=s(94),i=s(489),r=s(9108),c=s(7805),d=s(4090),o=s(7907),m=s(5879),x=s(9807),u=s(6288),h=s(5838),p=s(7220);function f(){let{role:e}=(0,h.j)(),[t,f]=(0,d.useState)(!1),[b,N]=(0,d.useState)(new Date().toISOString().split("T")[0]),[j,g]=(0,d.useState)([]),[y,v]=(0,d.useState)(null),[w,E]=(0,d.useState)(1),[S]=(0,d.useState)(10),[A,D]=(0,d.useState)(0),[k,_]=(0,d.useState)(!0),R=(0,o.useSearchParams)();async function T(){_(!0);try{let{data:e,count:t}=await (0,x.$f)(w,S,"",b);g(e||[]),D(t||0)}catch(e){console.error("Error fetching jobs:",e)}finally{_(!1)}}(0,d.useEffect)(()=>{T()},[w,b]),(0,d.useEffect)(()=>{"true"===R.get("new")&&(v(null),f(!0))},[R]);let C=async e=>{if(confirm("Bu iş emrini silmek istediğinize emin misiniz?"))try{let{error:t}=await x.OQ.from("work_orders").delete().eq("id",e);if(t)throw t;T()}catch(e){console.error(e),alert("Silinemedi.")}},I=e=>{v(e),f(!0)},O=Math.ceil(A/S),M=(0,p.Fs)(e||void 0,p._I.CAN_DELETE);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.h,{title:"İş Emirleri"}),(0,a.jsxs)("div",{className:"p-8 space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-slate-800",children:"İş Emirleri"}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 bg-white rounded-lg border border-slate-200 p-1",children:[(0,a.jsx)("span",{className:"text-xs font-semibold text-slate-500 px-2",children:"Tarih:"}),(0,a.jsx)("input",{type:"date",value:b,onChange:e=>{N(e.target.value),E(1)},className:"px-2 py-1.5 text-sm font-bold text-slate-700 bg-slate-50 rounded border border-slate-200 hover:bg-slate-100 outline-none"}),(0,a.jsx)("button",{onClick:()=>{N(new Date().toISOString().split("T")[0]),E(1)},className:"px-3 py-1.5 text-sm font-medium text-slate-600 hover:bg-slate-50 rounded",children:"Bug\xfcn"})]}),(0,a.jsxs)("button",{onClick:()=>{v(null),f(!0)},className:"flex items-center gap-2 rounded-lg bg-blue-600 px-4 py-2 font-medium text-white transition-colors hover:bg-blue-700 shadow-md shadow-blue-200",children:[(0,a.jsx)(n.Z,{className:"h-4 w-4"}),"Yeni İş Emri"]})]})]}),(0,a.jsxs)("div",{className:"rounded-xl border border-slate-200 bg-white shadow-sm p-6 min-h-[500px]",children:[(0,a.jsx)("h3",{className:"text-sm font-bold text-slate-900 mb-4",children:"Mevcut İş Emirleri"}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-left text-sm",children:[(0,a.jsx)("thead",{className:"bg-white text-slate-500 border-b border-slate-100",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-3 font-medium",children:"M\xfcşteri"}),(0,a.jsx)("th",{className:"px-4 py-3 font-medium",children:"Tarih"}),(0,a.jsx)("th",{className:"px-4 py-3 font-medium",children:"A\xe7ıklama"}),(0,a.jsx)("th",{className:"px-4 py-3 font-medium",children:"Personel"}),(0,a.jsx)("th",{className:"px-4 py-3 font-medium",children:"Tutar"}),(0,a.jsx)("th",{className:"px-4 py-3 font-medium",children:"Durum"}),(0,a.jsx)("th",{className:"px-4 py-3 text-right font-medium",children:"İşlemler"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-slate-50",children:k?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:7,className:"p-8 text-center text-slate-500",children:"Y\xfckleniyor..."})}):0===j.length?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:7,className:"px-4 py-8 text-center text-slate-500",children:"Se\xe7ilen tarihte iş emri bulunamadı."})}):j.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-slate-50/50",children:[(0,a.jsx)("td",{className:"px-4 py-4 font-bold text-slate-900",children:e.customer}),(0,a.jsx)("td",{className:"px-4 py-4 text-slate-800 font-medium",children:new Date(e.date).toLocaleDateString("tr-TR")}),(0,a.jsx)("td",{className:"px-4 py-4 text-slate-800",children:e.description}),(0,a.jsx)("td",{className:"px-4 py-4",children:(0,a.jsx)("span",{className:"inline-flex items-center px-2.5 py-1 rounded bg-slate-100 text-xs font-bold text-slate-600",children:Array.isArray(e.personnel)?e.personnel.join(", "):e.personnel||"Belirsiz"})}),(0,a.jsxs)("td",{className:"px-4 py-4 font-bold text-slate-900",children:["₺",(e.amount||0).toLocaleString("tr-TR",{minimumFractionDigits:2})]}),(0,a.jsx)("td",{className:"px-4 py-4",children:(0,a.jsx)("span",{className:"inline-block px-3 py-1 text-xs font-bold rounded ".concat("pending"===e.status?"bg-orange-100 text-orange-700":"approved"===e.status?"bg-blue-100 text-blue-700":"completed"===e.status?"bg-green-100 text-green-700":"cancelled"===e.status?"bg-red-100 text-red-700":"bg-slate-100 text-slate-700"),children:"pending"===e.status?"Onay Bekliyor":"approved"===e.status?"Onaylandı":"completed"===e.status?"Tamamlandı":"cancelled"===e.status?"İptal":e.status})}),(0,a.jsx)("td",{className:"px-4 py-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,a.jsx)("button",{onClick:()=>I(e),className:"px-3 py-1 rounded border border-slate-200 text-xs font-bold text-slate-700 hover:bg-slate-50",children:"D\xfczenle"}),M&&(0,a.jsx)("button",{onClick:()=>C(e.id),className:"p-1.5 rounded text-red-500 hover:bg-red-50",children:(0,a.jsx)(i.Z,{className:"h-4 w-4"})})]})})]},e.id))})]})}),O>1&&(0,a.jsxs)("div",{className:"mt-4 flex items-center justify-between border-t border-slate-100 pt-4",children:[(0,a.jsxs)("div",{className:"text-sm text-slate-500",children:["Toplam ",A," kayıt, Sayfa ",w," / ",O]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("button",{onClick:()=>E(e=>Math.max(1,e-1)),disabled:1===w,className:"flex items-center gap-1 rounded px-3 py-1.5 text-sm font-medium hover:bg-slate-100 disabled:opacity-50",children:[(0,a.jsx)(r.Z,{className:"h-4 w-4"})," \xd6nceki"]}),(0,a.jsxs)("button",{onClick:()=>E(e=>Math.min(O,e+1)),disabled:w===O,className:"flex items-center gap-1 rounded px-3 py-1.5 text-sm font-medium hover:bg-slate-100 disabled:opacity-50",children:["Sonraki ",(0,a.jsx)(c.Z,{className:"h-4 w-4"})]})]})]})]})]}),(0,a.jsx)(m.t,{isOpen:t,onClose:()=>{f(!1),T()},initialData:y,onSave:async e=>{try{if(y&&y.id){let{updateWorkOrder:t}=await Promise.resolve().then(s.bind(s,9807));await t(y.id,e),u.toast.success("İş emri g\xfcncellendi.")}else{let{createWorkOrder:t}=await Promise.resolve().then(s.bind(s,9807));await t(e),u.toast.success("İş emri oluşturuldu.")}f(!1),T()}catch(e){throw console.error(e),e}}})]})}},7220:function(e,t,s){"use strict";s.d(t,{Fs:function(){return r},_I:function(){return n},mn:function(){return i}});let a={ADMIN:"sistem y\xf6neticisi",DATA_ENTRY:"veri girici",FIELD_SUPERVISOR:"saha sorumlusu",DRIVER:"şof\xf6r"},l={[a.ADMIN]:["*"],[a.DATA_ENTRY]:["*","!/kullanicilar"],[a.FIELD_SUPERVISOR]:["*","!/raporlama","!/gelir-gider","!/kullanicilar"],[a.DRIVER]:["/gunluk-program","/login"]},n={CAN_DELETE:[a.ADMIN],CAN_APPROVE_WORK_ORDER:[a.ADMIN,a.DATA_ENTRY],CAN_MANAGE_ACCRUALS:[a.ADMIN,a.DATA_ENTRY]};function i(e,t){if(!e)return!1;if("/"===t||"/login"===t)return!0;let s=t.split("?")[0],a=l[e];return!!a&&(a.includes("*")?!a.filter(e=>e.startsWith("!")).map(e=>e.substring(1)).some(e=>s.startsWith(e)):a.some(e=>s.startsWith(e)))}function r(e,t){return!!e&&t.includes(e)}},7805:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(7461).Z)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]])}},function(e){e.O(0,[257,288,250,224,807,503,879,971,69,744],function(){return e(e.s=7747)}),_N_E=e.O()}]);